name: 📼 VHS

on:
  push:
    branches:
      - main
    paths:
      - "**.tape"
      - ".github/workflows/vhs.yml"
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  VHS:
    runs-on: macOS-13

    steps:
      - name: 🚚 Checkout Repository
        uses: actions/checkout@v4

      - name: 🐹 Setup Go
        uses: actions/setup-go@v5
        with:
          go-version-file: "go.mod"

      - name: 📑 Install mli
        run: go install github.com/${{ github.repository }}@latest

      - name: 🗑️ Delete Login Items
        run: osascript -e 'tell app "System Events" to delete login items'

      - name: ☀️ Record Light Load Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/light/load.tape"
          install-fonts: true

      - name: ☀️ Record Light Save Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/light/save.tape"
          install-fonts: true

      - name: 🌕 Record Dark Load Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/dark/load.tape"
          install-fonts: true

      - name: 🌕 Record Dark Save Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/dark/save.tape"
          install-fonts: true

      - name: 🎈 Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: |
            docs(vhs): Update GIF image generated by VHS

            Because of the change of related files.
          branch: update-vhs
          title: Update GIF image with VHS
          labels: docs
