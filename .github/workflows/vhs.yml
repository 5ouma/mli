name: 📼 VHS

on:
  push:
    branches:
      - main
    paths:
      - "**.tape"
      - ".github/workflows/vhs.yml"
  workflow_dispatch:

permissions:
  pull-requests: write

jobs:
  VHS:
    strategy:
      matrix:
        commands: [load, save]
    runs-on: macOS-13

    steps:
      - name: 🚚 Checkout Repository
        uses: actions/checkout@v4

      - name: 🐹 Setup Go
        uses: actions/setup-go@v5
        with:
          go-version-file: "go.mod"

      - name: 🔨 Build a Binary and Export PATH
        run: |
          go mod tidy
          go build -ldflags='-s -w' .
          export PATH="$PWD:$PATH"

      - name: 🗑️ Delete Login Items
        run: osascript -e 'tell app "System Events" to delete login items'

      - name: ☀️ Record Light ${{ matrix.commands }} Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/light/${{ matrix.commands }}.tape"
          install-fonts: true

      - name: 🌕 Record Dark ${{ matrix.commands }} Tape
        uses: charmbracelet/vhs-action@v2
        with:
          path: ".github/assets/vhs/dark/${{ matrix.commands }}.tape"
          install-fonts: true

      - name: 🎈 Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: |
            docs(vhs): Update GIF image generated by VHS

            Because of the change of related files.
          branch: update-vhs
          title: Update GIF image with VHS
          labels: docs
